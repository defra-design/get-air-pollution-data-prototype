// Air Quality Map Styles
// Follows DEFRA flood map pattern

// Map container
.defra-map {
  position: fixed !important;
  z-index: 999;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: #A9DDEF;

  &__title {
    @include govuk-visually-hidden;
  }
}

// Override GOV.UK template styles when map is active
body:has(.defra-map) {
  .govuk-template {
    height: 100vh;
  }

  .govuk-template__body {
    position: fixed;
    overflow: hidden;
    top: 0px;
    right: 0px;
    bottom: 0px;
    left: 0px;
  }
}

.defra-map-html {
  height: 100vh;
}

.defra-map-body {
  position: fixed;
  overflow: hidden;
  top: 0px;
  right: 0px;
  bottom: 0px;
  left: 0px;
}

.defra-map-visibility-hidden {
  visibility: hidden;
}

// Map viewport
.defra-map-viewport {
  width: 100%;
  height: 100%;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;

  &:focus-visible {
    outline: 3px solid transparent;
    box-shadow: 0px 0px 0px 2px white, inset 0px 0px 0px 0px #0b0c0c, 0px 0px 0px 5px #0b0c0c, 0px 0px 0px 8px #ffdd00;
  }
}

// Exit button
.defra-map__exit {
  position: absolute;          
  top: 10px;
  left: 10px;
  z-index: 11;                
  height: 40px;
  font-size: 16px; 
  line-height: 40px;
  background-color: #fff;
  color: govuk-colour('black');
  border: 0;
  padding: 0 11px 0 0;           
  box-shadow: rgba(0,0,0,.1) 0 0 3px 2px;
  cursor: pointer;

  @include govuk-media-query($until: desktop) { width: 40px; }
  @include govuk-media-query($from: desktop)  { width: auto; }

  svg { display: inline-block; margin: 10px; vertical-align: top; }
  span { vertical-align: center; @include govuk-media-query($until: desktop){ @include govuk-visually-hidden; } }

  &:hover { background-color: govuk-colour('light-grey'); }
  &:focus-visible {
    outline: 3px solid transparent;
    box-shadow: 0 0 0 2px #fff, 0 0 0 5px #0b0c0c, 0 0 0 8px #ffdd00;
  }
}


// Open key button (mobile)
.defra-map__open-key {
  float: right;
  position: relative;
  margin: 10px 10px 0px 0px;
  height: 40px;
  width: 80px;
  padding: 0;
  border: 0;
  cursor: pointer;
  background-color: white;
  color: govuk-colour('black');
  font-size: 16px;
  line-height: 40px;
  box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 3px 2px;
  display: flex;
  align-items: center;
  justify-content: center;

  @include govuk-media-query($from: desktop) {
    display: none !important;
  }

  svg {
    display: block;
    margin-right: 4px;
  }

  &:hover {
    background-color: govuk-colour('light-grey');
  }

  &:focus-visible {
    outline: 3px solid transparent;
    box-shadow: 0px 0px 0px 2px white, inset 0px 0px 0px 0px #0b0c0c, 0px 0px 0px 5px #0b0c0c, 0px 0px 0px 8px #ffdd00;
  }

  pointer-events: auto;
}

// Map controls container
.defra-map-controls {
  position: absolute;
  z-index: 1;
  overflow: hidden;
  top: 0px;
  right: 0px;
  bottom: 0px;
  left: 0px;
  pointer-events: none;

  * {
    pointer-events: auto;
  }
}
/* container is already absolute; keep it */
.defra-map-controls__bottom-v3 {
  position: absolute;
  left: 10px;
  right: 0px;
  bottom: 10px;
  pointer-events: none;
  * { pointer-events: auto; }
}

/* replace your .defra-map-zoom block with: */
.defra-map-zoom {
  display: none;

  @include govuk-media-query($from: tablet) {
    display: block;
    position: absolute;        // ⬅️ instead of float/relative
    bottom: 0;
    right: 10px;               // sits at bottom-right
    width: 40px;
    background-color: #fff;
    box-shadow: rgba(0,0,0,.1) 0 0 3px 2px;
    z-index: 3;                // below exit, but above map
  }

  &-in,
  &-out {
    display: block;
    border: 0;
    height: 40px;
    width: 40px;
    padding: 0;
    cursor: pointer;
    background-color: #fff;
    color: govuk-colour('black');

    svg { display: block; margin: 10px; }

    &:hover { background-color: govuk-colour('light-grey'); }
    &:focus-visible {
      outline: 3px solid transparent;
      box-shadow: 0 0 0 2px #fff, 0 0 0 5px #0b0c0c, 0 0 0 8px #ffdd00;
      position: relative;
      z-index: 5;
    }

    &.zoom-disable {
      color: #c7c7c7; pointer-events: none;
      &:hover { background-color: #fff; }
    }
  }

  &-in { border-bottom: 1px solid govuk-colour('mid-grey'); }
}





/* menu button that shows when panel is closed */
.defra-map__menu {
  position: absolute;
  top: -130px;
  z-index: 8;
  height: 40px; 
  width: 40px;
  background: #fff;
  border: 0;
  box-shadow: rgba(0,0,0,.1) 0 0 3px 2px;
  display: grid;
  place-items: center;
  cursor: pointer;
    &:hover { background-color: govuk-colour('light-grey'); }
  svg path { fill: currentColor; }
    &:focus-visible {
      outline: 3px solid transparent;
      box-shadow: 0 0 0 2px #fff, 0 0 0 5px #0b0c0c, 0 0 0 8px #ffdd00;
    }
  
}


// Station info panel
.defra-map-info {
  position: absolute;
  touch-action: none;
  background-color: white;
  bottom: 10px;
  left: 10px;
  right: auto;
  z-index: 4;
  box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 3px 2px;
  display: none;

  &.visible {
    display: block;
  }

  @include govuk-media-query($from: tablet) {
    width: auto;
    max-width: 500px;
  }

  @include govuk-media-query($until: tablet) {
    left: 10px;
    right: 10px;
  }

  &:focus-visible {
    outline: 3px solid transparent;
    box-shadow: 0px 0px 0px 2px white, inset 0px 0px 0px 0px #0b0c0c, 0px 0px 0px 5px #0b0c0c, 0px 0px 0px 8px #ffdd00;
  }

  &__container {
    margin-right: 36px;
    padding: 15px;
  }

  &__close {
    position: absolute;
    top: 3px;
    right: 3px;
    width: 40px;
    height: 40px;
    padding: 0;
    border: 0;
    cursor: pointer;
    background-color: #ffffff;
    color: govuk-colour('black');

    svg {
      display: block;
      margin: 10px;
    }

    &:hover {
      background-color: govuk-colour('light-grey');
    }

    &:focus-visible {
      outline: 3px solid transparent;
      box-shadow: 0px 0px 0px 2px white, inset 0px 0px 0px 0px #0b0c0c, 0px 0px 0px 5px #0b0c0c, 0px 0px 0px 8px #ffdd00;
    }
  }
}

.station-info-list {
  margin: 0;
  
  dt {
    font-weight: 700;
    display: inline;
  }

  dd {
    display: inline;
    margin: 0;
  }
}

.station-info-row {
  margin-bottom: 10px;

  &:after {
    content: "";
    display: block;
  }
}

.status-indicator {
  display: inline-block;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  margin-right: 4px;
  vertical-align: middle;
}

// Station markers
.station-marker-container {
  cursor: pointer;
  // Container stays fixed - MapLibre handles positioning
  // Don't add any transform here!
}

.station-marker-inner {
  // Only the inner element scales
  transition: transform 0.2s ease-in-out;
  pointer-events: none; // Let events bubble to container
  
  .station-marker-container:hover & {
    transform: scale(1.3);
  }

  .station-marker-container:focus-visible & {
    outline: 3px solid #ffdd00;
    outline-offset: 2px;
  }
}

// MapLibre marker container fixes
.maplibregl-marker {
  // Ensure markers stay in place - don't override MapLibre's transform
  cursor: pointer;
}

// MapLibre overrides
.maplibregl-canvas {
  display: block !important;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}

.maplibregl-ctrl-attrib {
  display: none !important;
}

// Disable default MapLibre controls styling
.maplibregl-ctrl-group {
  display: none !important;
}



.panel {
  @include mq ($from: 520px) {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 450px;
    max-height: calc(100vh - 20px);
    display: block;
    pointer-events: auto;
    z-index: 9;
  }
  display: none;
  border: 2px solid #0b0c0c;
  overflow: hidden; // keep scroll behaviour inside .panel-scroll
}


#mobile-key-panel {
  @include mq ($from: 520px){
    pointer-events: auto;
    max-height: 100%;
    flex-direction: column;
    position: relative;
    display: block;
  }
  display: none;
  box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 3px 2px;
  width: 100%;
  background-color: #ffffff; /* Adjust background color */
  padding:  18px 18px 18px;
  bottom: 0;
  left: 0;
  box-sizing: border-box;
  @include govuk-font($size: 16);
 
}

.panel-scroll {
  margin-top: 2px;
  max-height: 68vh;
  overflow-y: auto;
  overflow-x: hidden;
  padding-right: 4px;
  padding-left: 10px;
  width: 100%;
  display: block;
}


#mobile-key-panel-bottom {
  @include mq ($from: 520px){
    display: none;
  }
  display: block;
  flex-direction: column;
  position: absolute;
  box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 3px 2px;
  width: 100%;
  background-color: #ffffff; /* Adjust background color */
  padding:  18px 18px 18px;
  bottom: 0;
  left: 0;
  box-sizing: border-box;
  @include govuk-font($size: 16);
  pointer-events: auto;
  &:focus-visible {
    border-top: 3px solid #0b0c0c;
    outline: 3px solid #ffdd00;
}
}

// panel buttons
.btn-container {
    margin: 10px 0 15px;
    display: flex;
    position: relative;
    box-sizing: border-box;
    width: 100%;
    padding: 0;
   flex-direction: column;
}

.btn-grp {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
    z-index: 1;
    width: 100%;
}

.panel-btn {
    height: 40px;
    width: 50%;
    background-color: transparent;
    padding: 0 5px 0 5px;
    border: none;
    justify-content: center;
    align-items: center;
    outline: transparent solid 3px;
    span {
    @include govuk-font($size: 16);
    font-weight: bold;
    }
    cursor: pointer;
    
}

.panel-btn[aria-pressed="true"] {
    border: 2px solid black;
    &:focus-visible{
        border: 3px solid #0b0c0c;
        outline: 3px solid #ffdd00;
        z-index: 5;
    }
}

.panel-btn[aria-pressed="false"] {
    background-color: rgb(248, 248, 248);
    margin: 0px -1px 0px 0px;
    border-width: 1px;
    border-style: solid;
    border-color: rgb(231, 231, 231);
    &:focus-visible{
        border: 3px solid #0b0c0c;
        outline: 3px solid #ffdd00;
        z-index: 5;
    }
}

.panel-btn[aria-pressed="false"] span {
    color: rgb(80, 90, 95);
    &:hover {
        color: #0b0c0c;
    }
}



/* Ensure JS control wins over MQs */
.panel[hidden] { display: none !important; }
.defra-map__menu[hidden] { display: none !important; }

/* Make SVGs inherit button colour so icons don't look blank */
.defra-map__exit svg path,
.defra-map__open-key svg path,
.defra-map__menu svg path,
.defra-map-zoom-in svg path,
.defra-map-zoom-out svg path { fill: currentColor; }

/* (From earlier) exit above everything; zoom bottom-right; menu 10px above zoom */
.defra-map__exit { position:absolute; top:10px; left:10px; z-index:11; }
.defra-map-zoom   { @include govuk-media-query($from: tablet){ position:absolute; bottom:0; right:10px; } }
.defra-map__menu  { position:absolute; bottom:50px; right:10px; z-index:8; height:40px; width:40px; background:#fff; border:0; box-shadow: rgba(0,0,0,.1) 0 0 3px 2px; display:grid; place-items:center; }

// radio spacing on menu
.radio-mount { margin-top: 12px; }

// closed stations
.govuk-tag--black { background-color: #0b0c0c; color: #fff; }

.reopen-stack {
  position: absolute;
  right: 10px;
  bottom: 90px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  align-items: flex-end;     /* ⬅️ keep each button at its own intrinsic width */
  z-index: 8;
  pointer-events: none;
}
.reopen-stack > * { pointer-events: auto; }

.reopen-stack .defra-map__menu {
  position: static !important;
  top: auto !important;
  right: auto !important;
  bottom: auto !important;
  left: auto !important;
  width: auto !important;    /* ⬅️ ensure no old width constraints leak in */
  min-width: 0;              /* allow the narrower one to stay narrow */
  white-space: nowrap;       /* avoid text wrapping making widths inconsistent */
}

/* keep icon+text look you already added */
.reopen-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 0 10px;
}
.reopen-btn .reopen-text { @include govuk-font($size: 16); }

/* hide text on small screens like Exit button */
@include govuk-media-query($until: tablet) {
  .reopen-btn .reopen-text { @include govuk-visually-hidden; }
}


.station-header {
  display: flex;
  align-items: center;
  gap: 8px;               /* space between name and status tag */
}

.station-header .govuk-tag {
  margin-top: 10px;
  margin-bottom: 10px;
}


