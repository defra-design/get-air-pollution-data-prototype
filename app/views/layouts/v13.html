{#
For guidance on how to use layouts see:
https://prototype-kit.service.gov.uk/docs/how-to-use-layouts
#}

{% extends "govuk-prototype-kit/layouts/govuk-branded.njk" %}

{% set version = "version-13" %}
{% set bodyClasses = "version-13" %}


{% block header %}
  {{ govukHeader({
    homepageUrl: "/",
    serviceName: serviceName,
    serviceUrl: "/version-13/hub.html",
    containerClasses: "govuk-width-container"
  }) }}

  <div class="govuk-width-container">
<div class="govuk-phase-banner">
  <p class="govuk-phase-banner__content" >
    <strong class="govuk-tag govuk-phase-banner__content__tag">
      Beta
    </strong>
    <span class="govuk-phase-banner__text">
      This is a new service. Help us improve it and <a class="govuk-link" href="#">give your feedback (opens in new tab)</a>.
    </span>
  </p>
</div>
</div>

{{ govukServiceNavigation({
  navigation: [
    {
      href: "/version-13/hub",
      text: "Home"
    },
    {
      href: "/version-13/station/search-by",
      text: "Search by location"
    },
    {
      href: "/version-13/map",
      text: "Search on a map"
    },
    {
      href: "/version-13/data-selector/create-pollutant",
      text: "Create and download big datasets"
    }
  ]
}) }}
{% endblock %}

{% block beforeContent %}

{% endblock %}



{% block footer %}


  {{ govukFooter({
    meta: {
      items: [
        {
          href: "/mvp-final/privacy.html",
          text: "Privacy"
        },
        {
          href: "/mvp-final/cookies.html",
          text: "Cookies"
        },
        {
          href: "/mvp-final/accessibility.html",
          text: "Accessibility statement"
        },
        {
          href: "#",
          text: "Reset prototype",
          attributes: {
            id: "reset-prototype"
          }
        }
      ],
      visuallyHiddenTitle: "Footer links"
    }
  }) }}

{% endblock %}




{% block scripts %}
  {{ super() }}


<script>document.body.className += ' js-enabled' + ('noModule' in HTMLScriptElement.prototype ? ' govuk-frontend-supported' : '');</script>


  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>

  <!-- <script src="/public/javascripts/version_8/main.js"></script> -->

  <script src="/public/javascripts/bundles/autocomplete_p_13.bundle.js"></script>
  <script src="/public/javascripts/bundles/autocomplete_la_13.bundle.js"></script>

  <!-- Components -->
  <script src="/public/javascripts/version_13/components/toggletip.js"></script>
  <script src="/public/javascripts/version_13/components/status.js"></script>

  <!-- Graphs for 2024 -->
  <script src="/public/javascripts/version_13/graphs/2024/nitrogen.js"></script>
  <script src="/public/javascripts/version_13/graphs/2024/pm10.js"></script>
  <script src="/public/javascripts/version_13/graphs/2024/pm2_5.js"></script>
  <script src="/public/javascripts/version_13/graphs/2024/ozone.js"></script>

  <!-- Graphs for last month -->
  <script src="/public/javascripts/version_13/graphs/past-month/nitrogen.js"></script>
  <script src="/public/javascripts/version_13/graphs/past-month/pm10.js"></script>
  <script src="/public/javascripts/version_13/graphs/past-month/pm2_5.js"></script>
  <script src="/public/javascripts/version_13/graphs/past-month/ozone.js"></script>

  <!-- Graphs for last week -->
  <script src="/public/javascripts/version_13/graphs/past-week/nitrogen.js"></script>
  <script src="/public/javascripts/version_13/graphs/past-week/pm10.js"></script>
  <script src="/public/javascripts/version_13/graphs/past-week/pm2_5.js"></script>
  <script src="/public/javascripts/version_13/graphs/past-week/ozone.js"></script>

  <!-- Graphs for last 24 hours -->
  <script src="/public/javascripts/version_13/graphs/24/nitrogen.js"></script>
  <script src="/public/javascripts/version_13/graphs/24/pm10.js"></script>
  <script src="/public/javascripts/version_13/graphs/24/pm2_5.js"></script>
  <script src="/public/javascripts/version_13/graphs/24/ozone.js"></script>
    
<script>
document.addEventListener('DOMContentLoaded', () => {
  const resetLink = document.getElementById('reset-prototype');
  if (resetLink) {
    resetLink.addEventListener('click', e => {
      e.preventDefault();
      if (confirm('Clear all selections and start again?')) {
        sessionStorage.clear();
        // If you also store anything in localStorage, clear it too:
        // localStorage.clear();
        window.location.href = '/'; // or whatever your prototype start page is
      }
    });
  }
});
</script>
  
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const path = window.location.pathname.replace(/\/+$/, ''); // trim trailing slash

    // Define your journeys by path prefixes and known pages
    const journeys = [
      {
        key: 'home',
        match: (p) => p === '/version-13/hub' || p === '/version-13/hub.html' || p === '/version-13',
        navHref: '/version-13/hub'
      },
      {
        key: 'station',
        match: (p) =>
          p.startsWith('/version-13/station/') &&
          [
            '/version-13/station/birmingham-la',
            '/version-13/station/pm10-graph',
            '/version-13/station/results-b2-4qa',
            '/version-13/station/search-by',
            '/version-13/station/station'
          ].some(prefix => p.startsWith(prefix)),
        navHref: '/version-13/station/search-by'
      },
      {
        key: 'map',
        match: (p) => p === '/version-13/map' || p.startsWith('/version-13/map/'),
        navHref: '/version-13/map'
      },
      {
        key: 'data-selector',
        match: (p) =>
          p.startsWith('/version-13/data-selector/') &&
          [
            '/version-13/data-selector/add-datasource',
            '/version-13/data-selector/add-location',
            '/version-13/data-selector/add-pollutant',
            '/version-13/data-selector/add-time',
            '/version-13/data-selector/create-pollutant',
            '/version-13/data-selector/download'
          ].some(prefix => p.startsWith(prefix)),
        navHref: '/version-13/data-selector/create-pollutant'
      }
    ];

    // Find which journey applies
    const activeJourney = journeys.find(j => j.match(path));
    if (!activeJourney) return;

    // GOV.UK Service Navigation markup uses links; we mark the matching one as current
    const nav = document.querySelector('.govuk-service-navigation');
    if (!nav) return;

    const links = nav.querySelectorAll('a.govuk-service-navigation__link');
    links.forEach(function (link) {
      const href = (link.getAttribute('href') || '').replace(/\/+$/, '');

      // Clear state
      link.removeAttribute('aria-current');
      const li = link.closest('li');
      if (li) li.classList.remove('govuk-service-navigation__item--active');

      // Set active
      if (href === activeJourney.navHref.replace(/\/+$/, '')) {
        link.setAttribute('aria-current', 'page');
        if (li) li.classList.add('govuk-service-navigation__item--active');
      }
    });
  });
</script>

{% endblock %}