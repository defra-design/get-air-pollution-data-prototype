{% extends "layouts/v10.html" %}

{% set pageName="Home" %}

{% block beforeContent %}
{{ govukPhaseBanner({
  tag: {
    text: "Beta"
  },
  html: 'This is a new service. Help us improve it and <a class="govuk-link" href="#">give your feedback (opens in new tab)</a>.'
}) }}
<a href="create-pollutant.html" class="govuk-back-link">Back</a>
{% endblock %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">

   
    
 
    <div class="govuk-form-group">
      <fieldset class="govuk-fieldset" aria-describedby="time-hint">
        <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
          <h1 class="govuk-heading-l">
            Add year(s)
          </h1>
         <!--  <p class="govuk-body">Data is available in hourly, daily average or annual average format.</p> -->
           
       <div class="govuk-radios govuk-!-margin-top-0" data-module="govuk-radios">
  <!-- Year to date -->
  <div class="govuk-radios__item">
    <input class="govuk-radios__input" id="time-ytd" name="time" type="radio" value="ytd">
    <label class="govuk-label govuk-radios__label" for="time-ytd">
      Year to date (1 January to <span id="ytd-today"></span>)
    </label>
  </div>

  <!-- Any year (single year) -->
  <div class="govuk-radios__item">
    <input class="govuk-radios__input" id="time-any" name="time" type="radio" value="any" data-aria-controls="conditional-time-any">
    <label class="govuk-label govuk-radios__label" for="time-any">
      Any year
    </label>
    <div id="time-any-hint" class="govuk-hint govuk-radios__hint">
      Choose a single whole year
    </div>
  </div>
  <div class="govuk-radios__conditional govuk-radios__conditional--hidden" id="conditional-time-any">
    <div class="govuk-form-group">
      <label class="govuk-label" for="any-year-input">Year</label>
      <div id="any-year-hint" class="govuk-hint">For example: 2009</div>
      <input class="govuk-input govuk-input--width-4" id="any-year-input" name="any-year-input" type="text" inputmode="numeric" aria-describedby="any-year-hint">
    </div>
  </div>

  <!-- Range of years -->
  <div class="govuk-radios__item">
    <input class="govuk-radios__input" id="time-range" name="time" type="radio" value="range" data-aria-controls="conditional-time-range">
    <label class="govuk-label govuk-radios__label" for="time-range">
      Range of years
    </label>
    <div id="time-range-hint" class="govuk-hint govuk-radios__hint">
      Choose up to 5 whole years at a time
    </div>
  </div>
  <div class="govuk-radios__conditional govuk-radios__conditional--hidden" id="conditional-time-range">
    <div class="govuk-form-group">
      <label class="govuk-label" for="range-start-year">Enter start year</label>
      <div id="range-start-hint" class="govuk-hint">For example: 2009</div>
      <div class="govuk-date-input">
        <div class="govuk-date-input__item">
          <div class="govuk-form-group">
            <input class="govuk-input govuk-date-input__input govuk-input--width-4" id="range-start-year" name="range-start-year" type="text" inputmode="numeric" aria-describedby="range-start-hint">
          </div>
        </div>
      </div>
    </div>

    <div class="govuk-form-group">
      <label class="govuk-label" for="range-end-year">Enter end year</label>
      <div id="range-end-hint" class="govuk-hint">For example: 2010</div>
      <div class="govuk-date-input">
        <div class="govuk-date-input__item">
          <div class="govuk-form-group">
            <input class="govuk-input govuk-date-input__input govuk-input--width-4" id="range-end-year" name="range-end-year" type="text" inputmode="numeric" aria-describedby="range-end-hint">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
         
      </fieldset>
      
    </div>

    {{ govukButton({
      text: "Continue"
    }) }}
   
      </div>
    </div>
<!-- end of second row--><script>
document.querySelector('.govuk-button').addEventListener('click', function (e) {
  e.preventDefault();

  const selected = document.querySelector('input[name="time"]:checked');
  if (!selected) {
    alert('Please select a year option');
    return;
  }

  const today = new Date();
  const currentYear = today.getFullYear();
  const formattedToday = new Intl.DateTimeFormat('en-GB', {
    day: 'numeric', month: 'long', year: 'numeric'
  }).format(today);

  let timePeriod = 'None selected';

  if (selected.id === 'time-ytd') {
    // Year to date
    timePeriod = `1 January to ${formattedToday}`;
  }

  else if (selected.id === 'time-any') {
    // Any single year
    const year = (document.getElementById('any-year-input').value || '').trim();
    if (!year) {
      alert('Please enter a year');
      return;
    }
    // If the single year is the current year, stop at today; otherwise full year
    if (Number(year) === currentYear) {
      timePeriod = `1 January to ${formattedToday}`;
    } else {
      timePeriod = `1 January to 31 December ${year}`;
    }
  }

  else if (selected.id === 'time-range') {
    // Range of years
    const startYear = (document.getElementById('range-start-year').value || '').trim();
    const endYear   = (document.getElementById('range-end-year').value || '').trim();

    if (!startYear || !endYear) {
      alert('Please enter both start and end year');
      return;
    }

    // If the end year is the current year, stop at today; otherwise full end year
    if (Number(endYear) === currentYear) {
      timePeriod = `1 January ${startYear} to ${formattedToday}`;
    } else {
      timePeriod = `1 January ${startYear} to 31 December ${endYear}`;
    }
  }

  // Store the time period for the summary page
  sessionStorage.setItem('selectedTimePeriod', timePeriod);

  // Redirect back to the summary page
  window.location.href = 'create-pollutant.html';
});
</script>


<script>
document.addEventListener('DOMContentLoaded', function () {
  // Format like "1 August"
  const today = new Date();
  const formatted =
    new Intl.DateTimeFormat('en-GB', { day: 'numeric', month: 'long', year: 'numeric' }).format(today);

  const span = document.getElementById('ytd-today');
  if (span) span.textContent = formatted;
});
</script>



{% endblock %}
